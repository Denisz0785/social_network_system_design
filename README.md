## System Design социальной сети для курса по [System Design](https://balun.courses/courses/system_design)
Проектирование социальной сети для путешественников

### Функциональные требования:

1. Посты
   
   - Пользователь может создать пост с 1-5 фотографиями, текстом до 300 символов и привязкой к месту.
     
2. Комментарии
   
   - Пользователь может оставлять комментарии к постам. Максимальная длина комментария - 300 символов.
     
3. Лайки и дизлайки
   
   - Пользователь может поставить лайк или дизлайк на пост (только один на пост).
     
4. Подписки
   
   - Пользователь может подписываться на других пользователей и отменять подписку.
   - Лимит подписок: 10 000.
     
5. Поиск популярных мест
   
   - Пользователь может искать популярные места по названию (максимальная длина запроса - 100 символов).
    
6. Просмотр постов с конкретного места
   
   - Пользователь может просматривать посты из выбранного места.
   
7. Лента постов
   
   - Пользователь может просматривать ленту своих подписок в обратном хронологическом порядке.
   - Пользователь может просматривать ленту другого путешественника.
   
### Нефункциональные требования:

1. Производительность

   - Максимальная задержка при загрузке ленты: 3000 мс.
   - Максимальная задержка при отображении списка постов по месту: 3000 мс.
   - Максимальная задержка при поиске популярных мест: 3000 мс.
   - Максимальная задержка при загрузке поста - 2000мс.

2. Отказоустойчивость

   - Для защиты от отказов БД должна быть предусмотрена система резервного копирования данных или репликация БД.
   
3. Масштабируемость

   - Система должна поддерживать горизонтальное масштабирование для работы с возрастающим числом пользователей.
   - Чтение и запись данных должны быть распределены на разные базы (например, разделение на базы для чтения и записи),тк количество операций чтения значительно преобладает над операциями записи
   - Для поиска и отображения популярных мест и постов система должна поддерживать индексацию данных или кэширования для ускорения поиска.

4. Доступность

   - Требуемая доступность системы: 99,95%.
      
5. Прочее
   - 10 000 000 DAU
   - Геораспределение не требуется, тк приложение действует только в СНГ
   - Данные должны храниться всегда
   - Система должна поддерживать работу на мобильных устройствах и в браузере, обеспечивая удобный интерфейс для пользователей.
   - В сезон отпусков и праздников нагрузка на сервис может увеличиваться в 3-5 раз. более крупные:
       - летние отпуска, майские праздники: апрель - середина сентября
       - нг праздники: ноябрь - середина января
   

### Примерный размер данных:

    - Пост: 300 байт (текст на 300 символов) + 2500 КБ (5 фото) + 100 байт (идентификатор места) ~= 2,5мб.
 
    - Комментарий: 300 байт (текст на 300 символов).

    - Лайк/Дизлайк: идентификатор пользователя и поста — 2 * 4 байта = 8 байт
  
    - Подписка: идентификатор пользователя и подписки — 2 * 4 байта = 8 байт
  
    - Поиск: 200 байт (запрос не более 200 символов) + 100 байт на каждый пост/место

### Оценка нагрузки:

Рассчеты исходя из того, что ежедневно в сервисе активно 10% пользователей

#### Запись данных:

1. Посты:
``` 
Каждый активный пользователь создает 1 пост/день
rps: 1 000 000 постов/день или 1 000 000 / 86 400 = 12 rps
traffic: 12 (rps) * 2,5мб ~= 30мб/c
```

2. Комментарии:
``` 
Каждый активный пользователь в среднем делает 10 комментариев/день
rps: 1 000 000 * 10 = 10 000 000/день или 10 000 000 / 86400 = 120rps
traffic: 10 млн * 300 байт ~= 3 ГБ/день или 3гб/ 86400 = ~35кб/с
```

3. Лайки/Дизлайки:
```
Каждый активный пользователь в среднем ставит 30 лайков/день
rps: 1 000 000 * 30 = 30 00 000/день или 30 000 000 / 86400 ~= 350rps
traffic: 350 * 8 байт ~= 3кб/c 
```

4. Подписки:
``` 
Каждый активный пользователь в среднем делает 10 подписок/день
rps: 1 000 000 * 10 = 10 млн подписок в день или 10 000 000 / 86400 ~= 115rps
traffic: 115 * 8 байт ~= 920 байт/с
```

#### Чтение данных:

1. Лента:
```
Каждый активный пользователь просматривает 5 лент, в каждой ленте 10 постов.  
rps: 1 000 000 * 5 = 5 000 000 лент/день или 5 000 000 / 86400 ~= 58 rps  
traffic for media: 58 * (10 * 2,5 МБ) = 1450 МБ/с ~= 1,4ГБ/с
traffic for description of posts(текст поста + указатель на место): 58 * 10 * (300байт(текст) + 100байт(идентификатор места)) = 580 * 400байт ~= 230КБ/с 
```

2. Просмотр постов:
```
Каждый активный пользователь просматривает 20 постов/день.  
rps: 1 000 000 * 20 = 20 000 000/день или 20 000 000 / 86400 ~= 231 rps  
traffic for media: 231 * 2,5 МБ ~= 578 МБ/с
traffic for description of posts(текст поста + указатель на место): 231 * (300байт(текст) + 100байт(идентификатор места)) =  231 * 400байт ~= 92КБ/c 
```

3. Комментарии:
```
Каждый активный пользователь просматривает 20 постов, у каждого поста в среднем 50 комментариев.  
rps: 1 000 000 * (20 * 50) / 86400 ~= 11 574 rps  
traffic: 11 574 * 300 байт ~= 3,5 МБ/с  
```

4. Поиск мест:
```
Каждый активный пользователь делает 5 поисковых запросов по местам/день.  
rps: 1 000 000 * 5 = 5 000 000/день или 5 000 000 / 86400 ~= 58 rps  
traffic: 58 * 1кб(размер ответа на запрос) ~= 58 КБ/с
```


