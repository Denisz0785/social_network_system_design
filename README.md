## System Design социальной сети для курса по [System Design](https://balun.courses/courses/system_design)
Проектирование социальной сети для путешественников

### Функциональные требования:

1. Посты
   
   - Пользователь может создать пост с 1-10 фотографиями, текстом до 300 символов и привязкой к месту.
   - Если место не существует, оно создается автоматически.
   - Пользователь может редактировать текст и фото в своем посте.
   - Пользователь может удалить свой пост.
   - Другие пользователи могут просматривать посты.
  
2. Комментарии
   
   - Пользователь может оставлять комментарии к постам длиной до 300 символов.
   - Пользователь может редактировать и удалять свои комментарии.
   - Ответов на комментарии нет (вложенные комментарии не поддерживаются).
  
3. Лайки и дизлайки
   
   - Пользователь может поставить лайк или дизлайк на пост (только один на пост).
   - Пользователь может изменить свою реакцию (лайк → дизлайк или наоборот).
   - Пользователь может убрать реакцию без замены.
   - Количество лайков и комментариев влияет на популярность поста и места.
  
4. Подписки
   
   - Пользователь может подписываться на других пользователей и отменять подписку.
   - Лимит подписок: 10 000.
   - Приватных аккаунтов нет (все посты публичные).
   - Пользователь не может видеть, кто на него подписан.
  
5. Поиск популярных мест
   
   - Пользователь может искать популярные места по названию (до 100 символов).
   - Вывод постраничный, например, по 50 мест на страницу.
   - Популярность определяется по количеству постов, лайков и комментариев.
  
6. Просмотр постов с конкретного места
   
   - Пользователь может просматривать посты из выбранного места.
   - Сортировка:
     - По дате (от новых к старым).
     - По популярности (учитываются лайки и комментарии).
   - Вывод постраничный, например, по 20 постов на страницу.

7. Лента постов
   
   - Пользователь может просматривать ленту своих подписок в обратном хронологическом порядке.
   - Пользователь может просматривать ленту другого путешественника.
   - Лента может кэшироваться на ограниченное время. 


### Нефункциональные требования:

1. Производительность

   - Максимальная задержка при загрузке ленты: 1000 мс.
   - Максимальная задержка при отображении списка постов по месту: 500 мс.
   - Максимальная задержка при поиске популярных мест: 1000 мс.

2. Отказоустойчивость

   - Для защиты от отказов БД должна быть предусмотрена система резервного копирования данных или репликация БД.
   - В случае высокой нагрузки(например, в сезон отпусков и праздников), система должна поддерживать автоматическое масштабирование с помощью горизонтального масштабирования.
   
3. Безопасность

   - Необходима система аутентификации для пользователей (например, с использованием JWT токенов).
   - Для предотвращения спама — ограничения на частоту комментариев и лайков с одного аккаунта. Пользователь не может оставлять комментариев и лайков больше, чем 2/секунду и больше 1000/час.
   - Для защиты от атак (например, SQL-инъекции, XSS) система должна использовать методы санитизации входных данных и применять пароли с хешированием (например, bcrypt).

4. Масштабируемость

   - Система должна поддерживать горизонтальное масштабирование для работы с возрастающим числом пользователей.
   - Чтение и запись данных должны быть распределены на разные базы (например, разделение на базы для чтения и записи),тк количество операций чтения значительно преобладает над операциями записи
   - Для поиска и отображения популярных мест и постов система должна поддерживать индексацию данных или кэширования для ускорения поиска.

5. Доступность

   - Требуемая доступность системы: 99,95%.
   - Система должна поддерживать работу на мобильных устройствах и в браузере, обеспечивая удобный интерфейс для пользователей.
   - В случае сбоев в системе, должны быть предусмотрены автоматические перезапуски и мониторинг состояния компонентов.
   
6. Прочее
   - 10 000 000 DAU
   - Геораспределение не требуется, тк приложение действует только в СНГ
   - Данные должны храниться всегда


### Примерный размер данных:

    - Пост: 300 байт (текст на 300 символов) + 2500 КБ (5 фото) + 100 байт (идентификатор места) ~= 2,5мб.
 
    - Комментарий: 300 байт (текст на 300 символов).

    - Лайк/Дизлайк: идентификатор пользователя и поста — 2 * 4 байта = 8 байт
  
    - Подписка: идентификатор пользователя и подписки — 2 * 4 байта = 8 байт
  
    - Поиск: 200 байт (запрос не более 200 символов) + 100 байт на каждый пост/место

### Оценка нагрузки:

Рассчеты исходя из того, что ежедневно в сервисе активно 10% пользователей

#### Запись данных:

1. Посты:
``` 
Каждый активный пользователь создает 1 пост/день
rps: 1 000 000 постов/день или 1 000 000 / 86 400 = 12 rps
tps: 12 (rps) * 2,5мб ~= 30мб/c
requied memory per year: 1 000 000 постов * 2,5мб * 365 дней ~= 912ТБ/год
```

2. Комментарии:
``` 
Каждый активный пользователь в среднем делает 10 комментариев/день
rps: 1 000 000 * 10 = 10 000 000/день или 10 000 000 / 86400 = 120rps
tps: 10 млн * 300 байт ~= 3 ГБ/день или 3гб/ 86400 = ~35кб/с
required memory per year: 3гб * 365 ~= 1,1ТБ/год
```
3. Лайки/Дизлайки:
```
Каждый активный пользователь в среднем ставит 30 лайков/день
rps: 1 000 000 * 30 = 30 00 000/день или 30 000 000 / 86400 ~= 350rps
tps: 350 * 8 байт ~= 3кб/c 
required memory per year: 30 000 000 * 365 * 8 байт ~= 88ГБ/год 
```
4. Подписки:
``` 
Каждый активный пользователь в среднем делает 10 подписок/день
rps: 1 000 000 * 10 = 10 млн подписок в день или 10 000 000 / 86400 ~= 115rps
tps: 115 * 8 байт ~= 920 байт/с
required memory per year: 10 000 000 * 365 * 8 байт ~= 29ГБ/год
```
#### Чтение данных:

1. Лента:
```
Каждый активный пользователь просматривает 5 лент, в каждой ленте 10 постов.  
rps: 1 000 000 * 5 = 5 000 000 лент/день или 5 000 000 / 86400 ~= 58 rps  
tps: 58 * (10 * 2,5 МБ) = 1450 МБ/с ~= 1,4ГБ/с  
```
2. Просмотр постов:
```
Каждый активный пользователь просматривает 20 постов/день.  
rps: 1 000 000 * 20 = 20 000 000/день или 20 000 000 / 86400 ~= 231 rps  
tps: 231 * 2,5 МБ ~= 578 МБ/с  
```
3. Комментарии:
```
Каждый активный пользователь просматривает 20 постов, у каждого поста в среднем 50 комментариев.  
rps: 1 000 000 * (20 * 50) / 86400 ~= 11 574 rps  
tps: 11 574 * 300 байт ~= 3,5 МБ/с  
```
4. Поиск мест:
```
Каждый активный пользователь делает 5 поисковых запросов по местам/день.  
rps: 1 000 000 * 5 = 5 000 000/день или 5 000 000 / 86400 ~= 58 rps  
tps: 58 * 1кб(размер ответа на запрос) ~= 58 КБ/с
```
#### read/write ratio:

1980мб(общий tps на чтение) / 30мб (общий tps на запись) ~= 66, т.е. по объему передаваемых данных нагрузка на чтение в 66 раз превышает нагрузку на запись.


